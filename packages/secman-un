#!/bin/bash

goodBye() {
    echo "secman was uninstalled successfully... thanks you to trying secman"
}

usrLoc=/usr/local/bin
smLoc=$usrLoc/secman*
cgitLoc=$usrLoc/cgit*
verxLoc=$usrLoc/verx*
SECDIR=~/.secman
SM_DIR=/home/sm

clearAllData() {
    echo -e "clear all data?\n[y/N]"
    read -n 1 accept

    if [[ $accept == "Y" || $accept == "y" ]]; then
        if [ -x "$(command -v sudo)" ]; then
            if [ -x "$(command -v manx)" ]; then
                sudo manx $SECDIR

            else
                installManx

                if [ -x "$(command -v manx)" ]; then
                    sudo manx $SECDIR
                fi
            fi
        fi
    
    elif [[ $accept == "" || $accept == "N" || $accept == "n" ]]; then
        echo "ok"
    fi
    
    SM_GH_UN=$(git config user.name)

    echo "after clear, if you want to restore .secman you can clone it from your private repo in https://github.com/$SM_GH_UN/.secman"
}

installManx() {
    if [ -x "$(command -v sudo)" ]; then
        echo "installing manx..."
        sudo npm i -g @abdfnx/manx
    
    else
        npm i -g @abdfnx/manx
    fi
}

rmOpa() {
    if [ -x "$(command -v sudo)" ]; then
        sudo rm -rf $smLoc $cgitLoc $verxLoc $SM_DIR

    else
        rm -rf $smLoc $cgitLoc $verxLoc $SM_DIR
    fi

    clearAllData
}

rmMan() {
    if [ -x "$(command -v sudo)" ]; then
        sudo rm /usr/share/man/man1/secman*.1.gz

    else
        rm /usr/share/man/man1/secman*.1.gz
    fi
}

if [ -x "$(command -v secman)" ]; then
    rmOpa
    rmMan

    if ! [ -f "$smLoc" ]; then
        goodBye

    else
        echo "there's an error while uninstalling secman, try again"
    fi

else
    echo "there's no secman üòê"
fi
